<!DOCTYPE html>
<html xmlns:v-on="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>添加数据页面</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="/assets/css/main.css">

</head>

<body>
<div class="x-body" id="app">
    <form  class="layui-form" enctype="multipart/form-data">
        <div v-if="personDto">

        <div class="layui-form-item">
            <label for="personId" class="layui-form-label">
                <span class="text-color-red">*</span>
                人员编号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="personId" name="personId" v-model="personDto.personId" readonly="readonly" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                该内容暂不允许编辑
            </div>
        </div>

        <div class="layui-form-item">
            <label for="studentId" class="layui-form-label">
                <span class="text-color-red">*</span>
                学号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="studentId" name="studentId" v-model="personDto.studentId" readonly="readonly" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                该内容暂不允许编辑
            </div>
        </div>

        <div class="layui-form-item">
            <label for="depId" class="layui-form-label">
                <span class="text-color-red">*</span>
                学院编号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="depId" name="depId" v-model="personDto.depId" readonly="readonly" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                该内容暂不允许编辑
            </div>
        </div>

        <div class="layui-form-item">
            <label for="classId" class="layui-form-label">
                <span class="text-color-red">*</span>
                班级编号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="classId" name="classId" v-model="personDto.classId" readonly="readonly" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">
                该内容暂不允许编辑
            </div>
        </div>

        <div class="layui-form-item">
            <label  class="layui-form-label">
                <span class="text-color-red">*</span>
                实验室
            </label>
            <div class="layui-input-inline" >
                <div class="layui-input-inline">
                    <input type="text" id="labId" name="labId" v-model="labDto.labName"  lay-verify="required" autocomplete="off" class="layui-input">
                </div>
                </div>
            <div class="layui-form-mid layui-word-aux">
                默认本实验室，不可更改
            </div>
        </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="text-color-red">*</span>
                    人员照片
                </label>
                <div class="layui-input-inline">
                    <img :src="photoSrc" width="180"height="210">
                </div>
            </div>

                <div class="layui-form-item">
                    <label for="personName" class="layui-form-label">
                        <span class="text-color-red">*</span>
                        人员姓名
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="personName" name="personName" v-model="personDto.personName"  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="password" class="layui-form-label">
                        <span class="text-color-red">*</span>
                        密码
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="password" name="password" v-model="personDto.password"  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="major" class="layui-form-label">
                        <span class="text-color-red">*</span>
                        专业
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="major" name="major" v-model="personDto.major"  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label  class="layui-form-label">
                        <span class="text-color-red">*</span>
                        年级
                    </label>
                    <div class="layui-input-inline" >
                        <select name="grade"   lay-filter="grade"  lay-verify="required" >
                            <option v-bind:value="personDto.grade"
                               selected="selected" style ="display:none">{{ personDto.grade }}</option>
                            <option value="大一" >大一</option>
                            <option value="大二" >大二</option>
                            <option value="大三" >大三</option>
                            <option value="大四" >大四</option>
                        </select>
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                        只能选择未安排实验室的技术员
                    </div>
                </div>


                <div class="layui-form-item">
                    <label for="tel" class="layui-form-label">
                        <span class="text-color-red">*</span>
                        手机号
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="tel" name="tel" v-model="personDto.tel"  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="email" class="layui-form-label">
                        <span class="text-color-red">*</span>
                        邮箱
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="email" name="email" v-model="personDto.email"  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="Photofile" class="layui-form-label">
                        照片
                    </label>
                    <div class="layui-input-inline">
                        <!--   -->
                        <input type="file" id="Photofile" name="Photofile" v-on:change="photoFile($event)" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                        非必选项，可为空
                    </div>
                </div>

        <div class="layui-form-item">
            <label class="layui-form-label">
                <!-- placeholder -->
            </label>
            <button  type="button" class="layui-btn"  v-on:click="techAddPerson($event)">确认修改</button>
            <button type="button" class="layui-btn layui-btn-danger " v-on:click="close" >取消</button>
        </div>
        </div>
    </form>
</div>

<script type="text/javascript" src="/js/libs/jquery.min.js "></script>
<script type="text/javascript" src="/js/libs/layui/layui.js"></script>
<script type="text/javascript" src="/js/libs/vue/vue.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript" src="/js/utils.js"></script>
<script type="text/javascript" src="/js/libs/vue/vue-resource.js">
</script>

<script>
    // 初始化 Vue 组件
    var APP = new Vue({
        el: '#app',
        // 数据
        data: {
            personDto:{
                personId:"",
                planId:"",
                studentId:"",
                labId:"",
                labName:"",
                password:"",
                personName:"",
                depId:"",
                classId:"",
                major:"",
                grade:"",
                tel:"",
                email:"",
                photo:"",
                hirSta:"",
            },
            file: '',
            labDto:{
                labId:"",
                labName:""
            },
            photoSrc:"/laboratory/person/getPhotoById?personId=",
            contents:""
        },
        created: function () {
            this.getPersonById();
            initForm();
        },
        methods: {
            photoFile : function (event) {
                this.file = event.target.files[0]; // (利用console.log输出看结构就知道如何处理档案资料)
            },
            initGrade: function (val) {
               this.personDto.grade=val;
            },
            getPersonById: function () {
                var Id = location.hash.substring(1) // 去掉 #
                //发送 get 请求
                this.$http.get('/laboratory/person',
                    {params:{personId:Id}},
                    {emulateJSON:true}
                    ).then(function(result){
                    if(result.data.status==200){
                        this.personDto=result.data.data;
                        this.labDto=result.data.dataBackUp;
                         this.photoSrc+=this.personDto.personId;
                    }else {
                        messageError(result.data.message);
                    }
                },function(result){
                    messageError("服务器内部出错!");
                });

            },

            techAddPerson: function (event) {
                this.personDto.labId=this.labDto.labId;
                this.personDto.photo=null;
                event.preventDefault();
                let person = new FormData();
                person.append('personId', this.personDto.personId);
                person.append('planId', this.personDto.planId);
                person.append('studentId', this.personDto.studentId);
                person.append('labId', this.personDto.labId);
                person.append('labName', this.personDto.labName);
                person.append('password', this.personDto.password);
                person.append('personName', this.personDto.personName);
                person.append('depId', this.personDto.depId);
                person.append('classId', this.personDto.classId);
                person.append('major', this.personDto.major);
                person.append('grade', this.personDto.grade);
                person.append('tel', this.personDto.tel);
                person.append('email', this.personDto.email);
                person.append('photo', this.personDto.photo);
                person.append('hirSta', this.personDto.hirSta);
                if(this.file){
                    person.append('pfile', this.file);
                }
                //发送 post 请求  /* {emulateJSON:true}*/
                this.$http.post('/laboratory/person/tech/AddPerson',
                        person
                     ,
                    {
                        headers: { "Content-Type": "multipart/form-data" }
                    }
                    ).then(function(result){
                    messageLoading();
                    if(result.data.status==200){
                        messageOk(result.data.message);
                        //关闭弹出层
                        x_admin_close("reRender");
                    }else {
                        messageError(result.data.message);
                    }
                },function(res){
                    messageError("服务器内部出错!请重试~");
                });
            },
            close: function () {
                //关闭弹出层
                x_admin_close("app");
            }
        },

    });//end vue

    function initForm() {
            layui.use('form', function () {
                var form = layui.form;
                form.render('select');
                form.on('select(grade)',function (data) {
                    rend(data.value);
                });
            });
        }




    function rend(val) {
        this.APP.initGrade(val);
    }
</script>

</body>

</html>
